<h1 align="center">Air Quality</h1>
<h3 align="center">App to check the air quality</h3>

</br>

<p align="center">
<img alt="Swift Version" src="https://img.shields.io/badge/5.10-red?style=flat&logo=Swift&logoColor=white&label=Swift&labelColor=light_gray&color=orange"/>
<img alt="Platforms" src="https://img.shields.io/badge/iOS_17.0%2B-red?style=flat&logo=apple&logoColor=white&label=platforms&labelColor=light_gray&color=blue"/>
</a>

</br>

# Architecture

This application follows the Clean Architecture principles.

Check out more: https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html

### Presentation Layer

The presentation layer of this application is built entirely using `SwiftUI` in combination with the `MVVM+C` (Model-View-ViewModel-Coordinator) pattern.

The navigation in this app is powered by SwiftUI's `NavigationView` with `NavigationPath`.

### DataSource Layer

- `Alamofire` library is used to perform HTTPS requests.
- `SwiftData` framework is used to store data.
- `CoreLocation` framework is used to retrieve the user's location.

# Concurrent code

The concurrent code in this project is implemented using the `Swift Concurrency` library. `Strict Concurrency Checking` setting is set to `Complete`.
All cases which **cannot be written** using the Concurrency library, are achieved by `Combine` library.

# Generation
- `SwiftGen` is used to generate resources such as images, colors, strings.
- `SwiftLint` is used to lint the code.
- `Xcodegen` is used to generate project (`project.pbxproj`) based on YAML files.

# Tests
This application utilizes the `XCTest` framework for testing purposes. 
All objects from the **Data Source**, **Application**, and **ViewModels** from the presentation layer are fully tested.

The application is informed about the type of tests via `ProcessInfo` `launchArguments`, which are defined in the project `Scheme`.

### Unit Tests
- Tests are structured following the `Given-When-Then` convention, ensuring clear and understandable test cases for various scenarios.
- Assertions in tests are handled by `XCTAssert()` functions.
- Asynchronus tests are achived by `XCTestExpectation` classes.

### UI Tests

#### Network Mocking
To mock a network connections during UI tests, a local `WireMock` server is used.

The `WireMock` server is started before the UI tests begin and it is shut down after the tests are completed.

The serverâ€™s response data and behavior are defined in the `__files` and `mappings` in the `WireMock` directory.

Why so complcated ðŸ˜€?

Setting up a local server basically does not require changes to the application source code, so it works the same way as the release version of the application. The defined server responses are in the same form as the responses of the real server. This ensures that the tests are able to check the correctness of decoding, mapping data and etc.
The application runs and behaves during UI tests exactly as it would in a real-world scenario, providing reliable and comprehensive test results.

#### Snapshot Testing

For quick and efficient validation of data display correctness, snapshot tests are performed.

During the tests, the current state of the applicationâ€™s UI is captured using: `XCUIScreen.main.screenshot()`.
Then the captured screenshot is compared to baseline images stored in the `__Snapshots__` directory, located in the UI test directory.
Discrepancies between the current and baseline images indicate visual regressions.

To achieve maximum precision of the compared images (98%), the simulator selected to handle them has the status bar and appearance parameters changed before the UI tests.

# CI/CD

### UI Tests

During tests conducted on a virtual machine, there is no possibility to view simulator screenshots. In order to be able to view simulator screenshots in case of UI snapshots tests failure, after them, simulator failed snapshots are moved to the `UITestsSnapshots` directory. Content of this directory becomes a `Github Action` artifact and is available for download after the pipeline is completed.

### Danger

To automate the Code Review process, the `Danger` tool is used. The `Xcode-Summury` plugin allows you to display test results, errors, and warnings in the code generated by `Xcode` and `SwiftLint` in Pull-request comments.


# Tools and dependencies:

- Danger: https://github.com/danger/danger
- Danger Xcode Summary: https://github.com/diogot/danger-xcode_summary
- SwiftLint: https://github.com/realm/SwiftLint
- SwiftGen: https://github.com/SwiftGen/SwiftGen
- XcodeGen: https://github.com/yonaskolb/XcodeGen
- SwiftSnapshotTesting: https://github.com/pointfreeco/swift-snapshot-testing
- WireMock: https://github.com/wiremock/wiremock
- Alamofire: https://github.com/Alamofire/Alamofire
